# Hi there üëã

## Introduction

**VAScanner/VAScanner** is the open source repository for our paper ***‚ÄúDoes the Vulnerability Threaten Our Projects? Automated Vulnerable API Detection for Third-Party Libraries‚Äù***.  

We proposed **VAScanner**, a vulnerable API detection system for third-party libraries, which can precisely find vulnerable APIs used by Java projects based on comprehensive and precise vulnerable root methods.

We open source the **database** (`./Database`) we built which includes the vulnerable APIs mapping with vulnerable library versions and CVEs.

## Evaluation

To evaluate **VAScanner**, we conduct an experimental study on real-world projects.

### RQ1: The effectiveness of vulnerable root methods and vulnerable APIs

We identify the vulnerable root methods based on two mechanisms: filtering mechanism and augmentation mechanism.

We manually analyzed the filtered patch-unrelated methods and demonstrated the rationality of augmented vulnerable root methods, to demonstrate the effectiveness.
Due to the lack of ground truth for vulnerable APIs, we made a sampling analysis for validating the vulnerable API database.

#### Augmentation mechanism
* We summarized five patch patterns (`./result/augmentation_CVE.txt`) from  patch commits where a method was added to fix a known vulnerability.
* We checked each augmented vulnerable root method to demonstrate the efffectiveness of augmented vulnerable root methods (`./result/label_augmentation.json`) based on them.

#### Patch-unrelated filtering mechanism
* We have filtered patch-unrelated methods out (`./result/filtered_method.json`) to ensure the accuracy of patch methods.

* We selected randomly 50 CVE samples (`./dataset/filtering_sample_CVE.txt`) to analyze the effectiveness of the patch-unrelated filtering mechanism. 

* We analyzed filtered and unfiltered methods (i.e., patch methods) for each CVE sample, and generated the false positive cases and false negative cases of analysis (`./result/label_filtering_sample.json`).

#### Vulnerable API database
* We have established a common ground truth (`./result/label_VulAPI.json`,`./result/label_vulrootmethod_sample`) for evaluating the experiments. Finally, we obtained a sample set of 58 CVEs involving 981,805 vulnerable APIs (including 280 vulnerable root methods) to obtain the data sources of this ground truth.
* After manual analysis, we identified 2,470 vulnerable APIs (including 26 of 280 vulnerable
root methods) as false positives. Ultimately, the ground truth contains 979,335 vulnerable APIs, including 254 vulnerable root methods.
* As a result, the vulnerable API database has a false positive rate of 0.25% with an error margin of 0.01%.


### RQ2: Comparison with existing work

We demonstrate the effectiveness and superiority of VAScanner by comparing it with the state-of-the-art tool, **Eclipse Steady**, which is the only open-source tool that provides a forward reachability analysis at the method level.

#### Dataset
* We located 1,045 of 3,147 projects in $RQ4$ which depended on vulnerable libraries affected by the CVEs that are both maintained by Steady and VAScanner, and used them for a fair comparison with Steady.  (`./dataset/ProjDataSet.json`)

#### Result
* The reports which were generated by VAScanner and Steady seperately are located in `./result/VAScanner_report` and `./result/Steady_report`.
* We used the ground truth for vulnerable APIs in RQ1, and validated the experimental results (`false_positive_VAScanner.json`, `false_negative_VAScanner.json`,`false_negative_Steady.json`)

### RQ3: Ablation Study

We set up an ablation study on the proposed filtering mechanism and augmentation mechanism.

#### Dataset
Our proposed filtering and augmentation mechanisms affected 179 and 49 CVEs, respectively, involving 183 libraries with 6,529 library versions.  we selected 1,191 projects (`./dataset/ProjDataSet.json`) that are dependent on the 183 libraries from the 3,147 potential vulnerable projects.

#### Result
The reports which were generated by VAScanner, VAScanner- with filtering mechanism, and VAScanner- with none mechanism seperately are located in `./result/VAScanner_report` , `./result/VAScanner-_filtering_report`, and `./result/VAScanner-_report`.
* We used the ground truth for vulnerable APIs in RQ1, and validated the experimental results (`false_positive_only_VAScanner-.json`, `false_negative_only_VAScanner-.json`,`FP_sample_overlapping_vulAPI.json`)

### RQ4: Large-scale Analysis

We conducted a large-scale study on GitHub projects by leveraging VAScanner, to reveal the fact of using vulnerable APIs from vulnerable libraries in real-world projects.

#### Dataset
* We crawled 13,708 real-world projects with stars ranging from 70,000 to 0, among which 6,416 can be successfully compiled. Furthermore, we filtered projects that did not depend on the vulnerable library versions in $Database$, and obtained **3,147** real-world potentially vulnerable projects (`./dataset/ProjDataSet.json`). 

#### Result
* We detected 3,147 projects and generated reports for them (`./result/VAScanner_report`) by using VAScanner.
* We counted the frequency of vulnerable libraries and APIs invoked by aforementioned projects (`./result/freqLib.json`, `./result/freqMethod.json`).
* We conducted a sampling analysis to validate the detected results based on the ground truth for vulnerable APIs in RQ1, and the detected false positives are located in `FP_sample_VAScanner.json`.

## Using VAScanner
* We have open sourced the code for running VAScanner (`./runVAScanner`).

